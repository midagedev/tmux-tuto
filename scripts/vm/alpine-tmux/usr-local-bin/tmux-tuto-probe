#!/bin/sh

TMUXWEB_TMUX=0
if tmux -V >/dev/null 2>&1; then
  TMUXWEB_TMUX=1
fi

TMUXWEB_SESSION=-1
TMUXWEB_WINDOW=-1
TMUXWEB_PANE=-1
TMUXWEB_MODE=0
TMUXWEB_SESSION_NAME=""
TMUXWEB_WINDOW_NAME=""
TMUXWEB_ACTIVE_WINDOW=-1
TMUXWEB_LAYOUT=""
TMUXWEB_ZOOMED=0
TMUXWEB_SYNC=0

if [ "$TMUXWEB_TMUX" -eq 1 ]; then
  TMUXWEB_SESSION="$(tmux list-sessions 2>/dev/null | wc -l | tr -d ' ')"
  TMUXWEB_WINDOW="$(tmux list-windows 2>/dev/null | wc -l | tr -d ' ')"
  TMUXWEB_PANE="$(tmux list-panes 2>/dev/null | wc -l | tr -d ' ')"
  TMUXWEB_MODE="$(tmux display-message -p '#{?pane_in_mode,1,0}' 2>/dev/null || echo 0)"
  TMUXWEB_SESSION_NAME="$(tmux display-message -p '#S' 2>/dev/null | tr -d '\n\r')"
  TMUXWEB_WINDOW_NAME="$(tmux display-message -p '#W' 2>/dev/null | tr -d '\n\r')"
  TMUXWEB_ACTIVE_WINDOW="$(tmux display-message -p '#{window_index}' 2>/dev/null | tr -d ' ')"
  if [ -z "$TMUXWEB_ACTIVE_WINDOW" ]; then
    TMUXWEB_ACTIVE_WINDOW=-1
  fi
  TMUXWEB_LAYOUT="$(tmux display-message -p '#{window_layout}' 2>/dev/null | tr -d '\n\r')"
  TMUXWEB_ZOOMED="$(tmux display-message -p '#{window_zoomed_flag}' 2>/dev/null | tr -d ' ')"
  if [ -z "$TMUXWEB_ZOOMED" ]; then
    TMUXWEB_ZOOMED=0
  fi
  TMUXWEB_SYNC_RAW="$(tmux show-window-options -v synchronize-panes 2>/dev/null | tr -d '\n\r')"
  if [ "$TMUXWEB_SYNC_RAW" = "on" ]; then
    TMUXWEB_SYNC=1
  else
    TMUXWEB_SYNC=0
  fi
fi

echo "[[TMUXWEB_PROBE:tmux:${TMUXWEB_TMUX}]]"
echo "[[TMUXWEB_PROBE:session:${TMUXWEB_SESSION}]]"
echo "[[TMUXWEB_PROBE:window:${TMUXWEB_WINDOW}]]"
echo "[[TMUXWEB_PROBE:pane:${TMUXWEB_PANE}]]"
echo "[[TMUXWEB_PROBE:mode:${TMUXWEB_MODE}]]"
echo "[[TMUXWEB_PROBE:sessionName:${TMUXWEB_SESSION_NAME}]]"
echo "[[TMUXWEB_PROBE:windowName:${TMUXWEB_WINDOW_NAME}]]"
echo "[[TMUXWEB_PROBE:activeWindow:${TMUXWEB_ACTIVE_WINDOW}]]"
echo "[[TMUXWEB_PROBE:layout:${TMUXWEB_LAYOUT}]]"
echo "[[TMUXWEB_PROBE:zoomed:${TMUXWEB_ZOOMED}]]"
echo "[[TMUXWEB_PROBE:sync:${TMUXWEB_SYNC}]]"
